{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "pixelated-carousel",
  "type": "registry:ui",
  "dependencies": [
    "framer-motion"
  ],
  "files": [
    {
      "path": "components/ui/pixelated-carousel.tsx",
      "content": "'use client';\r\n\r\nimport Image from 'next/image';\r\nimport React, { useEffect, useRef, useState, useMemo, useCallback } from 'react';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface PixelatedCarouselProps {\r\n    pixelSize?: number;\r\n    animationDelayStep?: number;\r\n    images: string[];\r\n    pixelTransitionDuration?: number;\r\n}\r\n\r\nexport function PixelatedCarousel({\r\n    pixelSize = 100,\r\n    animationDelayStep = 0.02,\r\n    images,\r\n    pixelTransitionDuration = 0.1\r\n}: PixelatedCarouselProps) {\r\n    const [activeImageIndex, setActiveImageIndex] = useState(0);\r\n    const ref = useRef<HTMLDivElement>(null);\r\n    const [grid, setGrid] = useState<{ rows: number; cols: number }>({ rows: 0, cols: 0 });\r\n    const [isInitialized, setIsInitialized] = useState(false);\r\n    const [isFirstCycle, setIsFirstCycle] = useState(true);\r\n\r\n    const sizeOfBox = useMemo(() => {\r\n        if (!ref.current || grid.rows === 0 || grid.cols === 0) return { h: 0, w: 0 };\r\n        return { h: ref.current.clientHeight / grid.rows, w: ref.current.clientWidth / grid.cols };\r\n    }, [grid.rows, grid.cols]);\r\n\r\n    const shuffledDelays = useMemo(() => {\r\n        const totalBoxes = grid.rows * grid.cols;\r\n        if (totalBoxes === 0) return [];\r\n\r\n        const delays = Array.from({ length: totalBoxes }, (_, i) => i * pixelTransitionDuration);\r\n        for (let i = delays.length - 1; i > 0; i--) {\r\n            const j = Math.floor(Math.random() * (i + 1));\r\n            [delays[i], delays[j]] = [delays[j], delays[i]];\r\n        }\r\n        return delays;\r\n    }, [grid.rows, grid.cols, pixelTransitionDuration]);\r\n\r\n    const boxState = useMemo(() => {\r\n        if (shuffledDelays.length === 0) return [];\r\n        return shuffledDelays.map((delay) => {\r\n            const baseShade = 20 - Math.floor(Math.random() * 20);\r\n            return { delay, color: `rgb(${baseShade}, ${baseShade}, ${baseShade})` };\r\n        });\r\n    }, [shuffledDelays]);\r\n\r\n    const calculateGrid = useCallback(() => {\r\n        if (!ref.current) return { rows: 0, cols: 0 };\r\n        return { rows: Math.floor(ref.current.clientHeight / pixelSize), cols: Math.floor(ref.current.clientWidth / pixelSize) };\r\n    }, [pixelSize]);\r\n\r\n    const initialize = useCallback(() => {\r\n        const newGrid = calculateGrid();\r\n        setGrid((prev) => (prev.rows === newGrid.rows && prev.cols === newGrid.cols ? prev : newGrid));\r\n        setIsInitialized(true);\r\n    }, [calculateGrid]);\r\n\r\n    useEffect(() => {\r\n        initialize();\r\n        const handleResize = () => initialize();\r\n        window.addEventListener('resize', handleResize);\r\n        return () => window.removeEventListener('resize', handleResize);\r\n    }, [initialize]);\r\n\r\n    useEffect(() => {\r\n        if (!isInitialized || grid.rows === 0 || grid.cols === 0) return;\r\n\r\n        const allBoxesBlackTime = animationDelayStep * (grid.rows * grid.cols - 1) + pixelTransitionDuration;\r\n\r\n        if (isFirstCycle) {\r\n            const firstTimeout = setTimeout(() => {\r\n                setActiveImageIndex((prev) => (prev + 1) % images.length);\r\n                setIsFirstCycle(false);\r\n            }, allBoxesBlackTime * 1000);\r\n            return () => clearTimeout(firstTimeout);\r\n        } else {\r\n            const id = setInterval(() => {\r\n                setActiveImageIndex((prev) => (prev + 1) % images.length);\r\n            }, allBoxesBlackTime * 1000 * 2);\r\n            return () => clearInterval(id);\r\n        }\r\n    }, [images.length, grid.rows, grid.cols, isInitialized, isFirstCycle, animationDelayStep, pixelTransitionDuration]);\r\n\r\n    const gridElements = useMemo(() => {\r\n        if (!isInitialized || grid.rows === 0 || grid.cols === 0) return null;\r\n\r\n        return Array.from({ length: grid.rows }).map((_, row) => (\r\n            <span key={row} className=\"flex\">\r\n                {Array.from({ length: grid.cols }).map((_, col) => {\r\n                    const boxIndex = row * grid.cols + col;\r\n                    const box = boxState[boxIndex];\r\n                    if (!box) return null;\r\n\r\n                    return (\r\n                        <motion.span\r\n                            key={col}\r\n                            style={{ height: sizeOfBox.h, width: sizeOfBox.w, backgroundColor: box.color }}\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            transition={{\r\n                                duration: pixelTransitionDuration,\r\n                                repeat: Infinity,\r\n                                repeatType: 'reverse',\r\n                                delay: box.delay,\r\n                                repeatDelay: grid.rows * grid.cols * animationDelayStep\r\n                            }}\r\n                        />\r\n                    );\r\n                })}\r\n            </span>\r\n        ));\r\n    }, [isInitialized, grid.rows, grid.cols, boxState, sizeOfBox, pixelTransitionDuration, animationDelayStep]);\r\n\r\n    return (\r\n        <div ref={ref} className=\"h-full w-full relative\">\r\n            {isInitialized && <span className=\"h-full w-full absolute top-0 left-0 z-10\">{gridElements}</span>}\r\n            <div className=\"h-full w-full z-0 relative\">\r\n                {images.map((image, index) => (\r\n                    <Image\r\n                        src={image}\r\n                        key={image + index}\r\n                        alt=\"pixelated carousel\"\r\n                        fill\r\n                        className=\"object-cover absolute top-0 left-0 h-full w-full\"\r\n                        style={{ zIndex: activeImageIndex === index ? 10 : 0 }}\r\n                    />\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default PixelatedCarousel;\r\n",
      "type": "registry:ui",
      "target": "components/ui/pixelated-carousel.tsx"
    }
  ]
}