{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "file-input",
  "type": "registry:ui",
  "dependencies": [
    "framer-motion",
    "lucide-react"
  ],
  "files": [
    {
      "path": "components/ui/file-input.tsx",
      "content": "'use client';\r\n\r\nimport { cn } from '@/lib/utils';\r\nimport { AnimatePresence, motion } from 'framer-motion';\r\nimport {\r\n  CloudUpload,\r\n  File,\r\n  Globe,\r\n  MapPin,\r\n  FileText,\r\n  Image as ImageIcon,\r\n  Trash\r\n} from 'lucide-react';\r\nimport Image from 'next/image';\r\nimport React, { useEffect, useRef, useState } from 'react';\r\n\r\nconst validateFile = (\r\n  file: File,\r\n  accept?: string,\r\n  maxSizeInMB?: number\r\n): { success: boolean; message: string | null } => {\r\n  // Validate file type if accept is specified\r\n  if (accept) {\r\n    const acceptedTypes = accept.split(',').map((type) => type.trim());\r\n    const fileType = file.type;\r\n    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\r\n\r\n    const isValidType = acceptedTypes.some((acceptedType) => {\r\n      if (acceptedType.startsWith('.')) {\r\n        return acceptedType === fileExtension;\r\n      }\r\n      return acceptedType === fileType;\r\n    });\r\n\r\n    if (!isValidType) {\r\n      return { success: false, message: 'File type not accepted.' };\r\n    }\r\n  }\r\n\r\n  // Validate file size\r\n  if (maxSizeInMB) {\r\n    const fileSizeInMB = file.size / (1024 * 1024);\r\n    if (fileSizeInMB > maxSizeInMB) {\r\n      return { success: false, message: `File size exceeds ${maxSizeInMB}MB limit.` };\r\n    }\r\n  }\r\n\r\n  return { success: true, message: null };\r\n};\r\n\r\nconst formatFileSize = (bytes: number): string => {\r\n  if (bytes === 0) return '0 Bytes';\r\n  const k = 1024;\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n};\r\n\r\nconst getFileType = (file: File): 'image' | 'pdf' | 'text' | 'other' => {\r\n  if (file.type.startsWith('image/')) return 'image';\r\n  if (file.type === 'application/pdf') return 'pdf';\r\n  if (file.type.startsWith('text/')) return 'text';\r\n  return 'other';\r\n};\r\n\r\nconst getFileIcon = (fileType: 'image' | 'pdf' | 'text' | 'other') => {\r\n  switch (fileType) {\r\n    case 'image':\r\n      return <ImageIcon size={24} className=\"text-white\" />;\r\n    case 'pdf':\r\n      return <FileText size={24} className=\"text-white\" />;\r\n    case 'text':\r\n      return <FileText size={24} className=\"text-white\" />;\r\n    default:\r\n      return <File size={24} className=\"text-white\" />;\r\n  }\r\n};\r\n\r\ninterface IdleProps {\r\n  accept?: string;\r\n  maxSizeInMB?: number;\r\n  onClick: () => void;\r\n  onDrop: (e: React.DragEvent) => void;\r\n  error: string | null;\r\n}\r\n\r\nconst Idle = ({ accept, maxSizeInMB, onClick, onDrop, error }: IdleProps) => {\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragOver(true);\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragOver(false);\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragOver(false);\r\n    onDrop(e);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        `h-full w-full bg-black overflow-hidden relative border-[3px] border-dashed rounded-lg flex flex-col items-center justify-center select-none cursor-pointer transition-colors`,\r\n        isDragOver ? 'border-blue-500 bg-blue-950/20' : 'border-zinc-800 hover:border-zinc-700'\r\n      )}\r\n      onClick={onClick}\r\n      onDragOver={handleDragOver}\r\n      onDragLeave={handleDragLeave}\r\n      onDrop={handleDrop}\r\n    >\r\n      <CloudUpload size={40} className=\"text-blue-500\" />\r\n      <p className=\"text-sm text-zinc-200 font-medium\">Upload a file</p>\r\n      <p className=\"text-xs mt-2 text-zinc-400\">Click to upload or drag and drop</p>\r\n      {accept && (\r\n        <p className=\"text-xs text-zinc-400\">\r\n          Accepts:{' '}\r\n          {accept\r\n            ?.split(',')\r\n            .map((item) => `.${item.split('/').pop()?.trim()}`)\r\n            .join(', ')}\r\n        </p>\r\n      )}\r\n      {maxSizeInMB && <p className=\"text-xs text-zinc-400\">Max size: {maxSizeInMB} MB</p>}\r\n      {error && (\r\n        <motion.p\r\n          animate={{\r\n            x: [0, 2, -2, 2, -2, 0, 2, -2, 2, -2, 0]\r\n          }}\r\n          transition={{\r\n            duration: 0.3,\r\n            delay: 0.15\r\n          }}\r\n          className=\"text-xs text-red-500 absolute bottom-2\"\r\n        >\r\n          {error}\r\n        </motion.p>\r\n      )}\r\n\r\n      <AnimatePresence>\r\n        {isDragOver && (\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            transition={{ duration: 0.2, ease: 'easeOut' }}\r\n            className=\"absolute inset-0 backdrop-blur-sm bg-black/50 z-10 flex items-center justify-center flex-col rounded-xl\"\r\n          >\r\n            <MapPin size={32} className=\"text-blue-100\" />\r\n            <p className=\"text-sm text-blue-100 font-medium\">Drop your file here</p>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Loading = () => {\r\n  const fromRef = useRef<HTMLDivElement>(null);\r\n  const toRef = useRef<HTMLDivElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const [path, setPath] = useState<string>('');\r\n  const [containerSize, setContainerSize] = useState<{ width: number; height: number }>({\r\n    width: 0,\r\n    height: 0\r\n  });\r\n\r\n  const gradientCoordinates = {\r\n    x1: ['10%', '110%'],\r\n    x2: ['0%', '100%'],\r\n    y1: ['0%', '0%'],\r\n    y2: ['0%', '0%']\r\n  };\r\n\r\n  useEffect(() => {\r\n    const updatePath = () => {\r\n      if (!fromRef.current || !toRef.current || !containerRef.current) return;\r\n\r\n      const containerRect = containerRef.current.getBoundingClientRect();\r\n      const fromRect = fromRef.current.getBoundingClientRect();\r\n      const toRect = toRef.current.getBoundingClientRect();\r\n\r\n      setContainerSize({ width: containerRect.width, height: containerRect.height });\r\n\r\n      const x1 = fromRect.left - containerRect.left + fromRect.width / 2;\r\n      const y1 = fromRect.top - containerRect.top + fromRect.height / 2;\r\n      const x2 = toRect.left - containerRect.left + toRect.width / 2;\r\n      const y2 = toRect.top - containerRect.top + toRect.height / 2;\r\n\r\n      const controlY = x1 - 50;\r\n      const d = `M ${x1},${y1} Q ${(x1 + x2) / 2},${controlY} ${x2},${y2}`;\r\n      setPath(d);\r\n    };\r\n\r\n    const resizeObserver = new ResizeObserver((entries) => {\r\n      entries.forEach(() => {\r\n        updatePath();\r\n      });\r\n    });\r\n\r\n    if (containerRef.current) {\r\n      resizeObserver.observe(containerRef.current);\r\n    }\r\n\r\n    updatePath();\r\n\r\n    return () => {\r\n      resizeObserver.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"h-full w-full bg-black relative border-[3px] border-zinc-900 rounded-xl flex flex-col items-center justify-center gap-4\">\r\n      <div ref={containerRef} className=\"w-full px-10 flex items-center justify-between relative\">\r\n        <motion.span\r\n          animate={{\r\n            scale: [1, 1.05, 1]\r\n          }}\r\n          transition={{\r\n            duration: 1.5,\r\n            repeat: Infinity,\r\n            ease: 'easeInOut'\r\n          }}\r\n          ref={fromRef}\r\n          className=\"bg-black rounded-full border border-blue-400 p-2 z-10 h-10 w-10 flex items-center justify-center shadow-sm shadow-blue-500\"\r\n        >\r\n          <File size={20} strokeWidth={1.5} className=\"text-zinc-300\" />\r\n        </motion.span>\r\n        <motion.span\r\n          animate={{\r\n            scale: [1, 1.05, 1]\r\n          }}\r\n          transition={{\r\n            delay: 0.5,\r\n            duration: 1.5,\r\n            repeat: Infinity,\r\n            ease: 'easeInOut'\r\n          }}\r\n          ref={toRef}\r\n          className=\"bg-black rounded-full border border-blue-400 p-2 z-10 h-10 w-10 flex items-center justify-center shadow-sm shadow-blue-500\"\r\n        >\r\n          <Globe size={32} strokeWidth={1.5} className=\"text-zinc-300\" />\r\n        </motion.span>\r\n        <svg\r\n          fill=\"none\"\r\n          width={containerSize.width}\r\n          height={containerSize.height}\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          className={cn('pointer-events-none absolute left-0 top-0 transform-gpu stroke-2')}\r\n          viewBox={`0 0 ${containerSize.width} ${containerSize.height}`}\r\n        >\r\n          <path\r\n            d={path}\r\n            stroke=\"#3F3F47\"\r\n            strokeWidth={1}\r\n            strokeOpacity={0.8}\r\n            strokeLinecap=\"round\"\r\n          />\r\n          <path\r\n            d={path}\r\n            strokeWidth={3}\r\n            stroke={`url(#${'path'})`}\r\n            strokeOpacity=\"1\"\r\n            strokeLinecap=\"round\"\r\n          />\r\n          <defs>\r\n            <motion.linearGradient\r\n              className=\"transform-gpu\"\r\n              id={'path'}\r\n              gradientUnits={'userSpaceOnUse'}\r\n              initial={{\r\n                x1: '0%',\r\n                x2: '0%',\r\n                y1: '0%',\r\n                y2: '0%'\r\n              }}\r\n              animate={{\r\n                x1: gradientCoordinates.x1,\r\n                x2: gradientCoordinates.x2,\r\n                y1: gradientCoordinates.y1,\r\n                y2: gradientCoordinates.y2\r\n              }}\r\n              transition={{\r\n                duration: 1.5,\r\n                ease: 'easeInOut',\r\n                repeat: Infinity,\r\n                repeatType: 'loop'\r\n              }}\r\n            >\r\n              <stop stopColor={'#ffffff'} stopOpacity=\"0\"></stop>\r\n              <stop stopColor={'#ffffff'} stopOpacity=\"0.3\"></stop>\r\n              <stop offset=\"15%\" stopColor={'#00bfff'} stopOpacity=\"1\"></stop>\r\n              <stop offset=\"30%\" stopColor={'#0080ff'} stopOpacity=\"0.8\"></stop>\r\n              <stop offset=\"50%\" stopColor={'#0066cc'} stopOpacity=\"0.6\"></stop>\r\n              <stop offset=\"70%\" stopColor={'#004499'} stopOpacity=\"0.4\"></stop>\r\n              <stop offset=\"85%\" stopColor={'#002266'} stopOpacity=\"0.2\"></stop>\r\n              <stop offset=\"100%\" stopColor={'#001133'} stopOpacity=\"0\"></stop>\r\n            </motion.linearGradient>\r\n          </defs>\r\n        </svg>\r\n      </div>\r\n      <p className=\"text-xs text-zinc-300 font-light\">Uploading file...</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Preview = ({ file }: { file: File }) => {\r\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\r\n  const [previewLoaded, setPreviewLoaded] = useState(false);\r\n  const fileType = getFileType(file);\r\n  const fileIcon = getFileIcon(fileType);\r\n\r\n  useEffect(() => {\r\n    if (fileType === 'image') {\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        setImagePreview(e.target?.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    } else {\r\n      setPreviewLoaded(true);\r\n    }\r\n  }, [file, fileType]);\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, scale: 0.8 }}\r\n      animate={{ opacity: previewLoaded ? 1 : 0, scale: previewLoaded ? 1 : 0.8 }}\r\n      transition={{ duration: 0.3, ease: 'easeInOut', delay: 0.2 }}\r\n      className=\"relative w-full h-full rounded-lg overflow-hidden border border-zinc-700 flex items-center justify-center\"\r\n    >\r\n      {fileType === 'image' && imagePreview ? (\r\n        <Image\r\n          onLoad={() => setPreviewLoaded(true)}\r\n          src={imagePreview}\r\n          alt=\"File preview\"\r\n          fill\r\n          className=\"w-full h-full object-cover\"\r\n        />\r\n      ) : (\r\n        <div className=\"w-full h-full bg-zinc-800 flex items-center justify-center\">{fileIcon}</div>\r\n      )}\r\n    </motion.div>\r\n  );\r\n};\r\n\r\ninterface SuccessProps {\r\n  files: FileList;\r\n  onRemove: () => void;\r\n}\r\n\r\nconst Success = ({ files, onRemove }: SuccessProps) => {\r\n  return (\r\n    <div className=\"h-full w-full bg-black relative border-[3px] border-zinc-900 rounded-xl flex flex-col items-center justify-center gap-4 overflow-hidden\">\r\n      <div className=\"w-full flex-1 flex flex-col items-center justify-center gap-3 relative h-full overflow-hidden\">\r\n        <div className=\"absolute top-0 left-0 w-full h-full\">\r\n          {files.length === 1 ? (\r\n            <Preview file={files[0]} />\r\n          ) : (\r\n            <div className=\"h-full w-full flex items-center justify-center\">\r\n              {Array.from(files)\r\n                .slice(0, 4)\r\n                .map((file, index) => {\r\n                  return (\r\n                    <motion.div\r\n                      key={`file-upload-preview-${index}-${file.name}`}\r\n                      style={{\r\n                        rotateZ: files.length <= 2 ? index * 15 : -(15 - index * 15),\r\n                        x: files.length <= 2 ? index * 10 : index * 15 - 15,\r\n                        y: index * 10\r\n                      }}\r\n                      className=\"h-3/4 w-3/4 absolute\"\r\n                    >\r\n                      <Preview file={file} />\r\n                    </motion.div>\r\n                  );\r\n                })}\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div\r\n          style={{\r\n            // background: 'black',\r\n            backdropFilter: 'blur(10px)',\r\n            WebkitBackdropFilter: 'blur(10px)',\r\n            maskImage: 'linear-gradient(to bottom, transparent, black 80%)',\r\n            WebkitMaskImage: 'linear-gradient(to bottom, transparent, black 80%)'\r\n          }}\r\n          className=\"absolute inset-0\"\r\n        />\r\n\r\n        <div className=\"absolute inset-0 flex flex-col items-start justify-end p-3 bg-black/20\">\r\n          <div className=\"flex items-end justify-between w-full\">\r\n            <div className=\"flex flex-col items-start justify-end flex-1\">\r\n              <p className=\"text-sm text-white font-medium line-clamp-1\">\r\n                {files.length > 1 ? `${files.length} files` : files[0].name}\r\n              </p>\r\n              <p className=\"text-xs text-white line-clamp-1\">\r\n                {formatFileSize(Array.from(files).reduce((acc, file) => acc + file.size, 0))}\r\n              </p>\r\n            </div>\r\n            <button\r\n              type=\"button\"\r\n              onClick={onRemove}\r\n              className=\"p-2 rounded-full hover:bg-white/5 group\"\r\n            >\r\n              <Trash size={16} className=\"group-hover:text-red-600/90\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\ninterface FileInputProps {\r\n  accept?: string; // e.g. 'image/png, image/jpeg, application/pdf\r\n  maxSizeInMB?: number;\r\n  onFileChange?: (files: FileList) => void | Promise<void>;\r\n  allowMultiple?: boolean;\r\n}\r\n\r\nconst FileInput = ({\r\n  accept = 'image/png, image/jpeg, application/pdf',\r\n  maxSizeInMB = 10,\r\n  onFileChange,\r\n  allowMultiple = false\r\n}: FileInputProps) => {\r\n  const [state, setState] = useState<'idle' | 'loading' | 'success'>('idle');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [files, setFiles] = useState<FileList | null>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleFileInputClick = () => {\r\n    fileInputRef.current?.click();\r\n  };\r\n\r\n  const onChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setError(null);\r\n    const files = e.target.files;\r\n    let file = e.target.files?.[0];\r\n\r\n    if (!file || !files) return;\r\n\r\n    for (let i = 0; i < files.length; i++) {\r\n      file = files[i];\r\n      const { success, message } = validateFile(file, accept, maxSizeInMB);\r\n      if (!success) {\r\n        setError(message || 'Something went wrong.');\r\n        return;\r\n      }\r\n    }\r\n\r\n    console.log('file', file);\r\n\r\n    setState('loading');\r\n    try {\r\n      await onFileChange?.(files);\r\n    } catch (error) {\r\n      console.error(error);\r\n      setState('idle');\r\n      setError('Something went wrong.');\r\n      return;\r\n    }\r\n    await new Promise((resolve) => setTimeout(resolve, 3000));\r\n    setFiles(files);\r\n    setState('success');\r\n  };\r\n\r\n  const handleDrop = async (e: React.DragEvent) => {\r\n    setError(null);\r\n    const files = e.dataTransfer.files;\r\n    if (files.length === 0) return;\r\n\r\n    let file = files[0];\r\n\r\n    for (let i = 0; i < files.length; i++) {\r\n      file = files[i];\r\n      const { success, message } = validateFile(file, accept, maxSizeInMB);\r\n      if (!success) {\r\n        setError(message || 'Something went wrong.');\r\n        return;\r\n      }\r\n    }\r\n\r\n    console.log('file', file);\r\n\r\n    setState('loading');\r\n    try {\r\n      await onFileChange?.(files);\r\n    } catch (error) {\r\n      console.error(error);\r\n      setState('idle');\r\n      setError('Something went wrong.');\r\n      return;\r\n    }\r\n    await new Promise((resolve) => setTimeout(resolve, 3000));\r\n    setFiles(files);\r\n    setState('success');\r\n  };\r\n\r\n  const handleRemove = () => {\r\n    setFiles(null);\r\n    if (fileInputRef.current) {\r\n      fileInputRef.current.value = '';\r\n    }\r\n    setState('idle');\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-[300px] h-[200px] relative overflow-hidden\">\r\n      <input\r\n        type=\"file\"\r\n        ref={fileInputRef}\r\n        className=\"hidden\"\r\n        accept={accept}\r\n        onChange={onChange}\r\n        multiple={allowMultiple}\r\n      />\r\n      <AnimatePresence mode=\"popLayout\" initial={false}>\r\n        <motion.div\r\n          key={state}\r\n          className=\"h-full w-full overflow-hidden rounded-xl\"\r\n          initial={{\r\n            y: state === 'loading' ? '-100%' : '100%',\r\n            filter: 'blur(10px)',\r\n            scale: 1,\r\n            borderRadius: '100%'\r\n          }}\r\n          animate={{ y: 0, filter: 'blur(0px)', scale: 1, borderRadius: '0%' }}\r\n          exit={{\r\n            y: ['loading', 'success'].includes(state) ? '-100%' : '100%',\r\n            filter: 'blur(10px)',\r\n            scale: 0.7,\r\n            borderRadius: '100%'\r\n          }}\r\n          transition={{\r\n            type: 'spring',\r\n            duration: 0.4,\r\n            bounce: 0\r\n          }}\r\n        >\r\n          {state === 'idle' && (\r\n            <Idle\r\n              accept={accept}\r\n              maxSizeInMB={maxSizeInMB}\r\n              onClick={handleFileInputClick}\r\n              onDrop={handleDrop}\r\n              error={error}\r\n            />\r\n          )}\r\n          {state === 'loading' && <Loading />}\r\n          {state === 'success' && files && <Success files={files} onRemove={handleRemove} />}\r\n        </motion.div>\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FileInput;\r\n",
      "type": "registry:ui",
      "target": "components/ui/file-input.tsx"
    }
  ]
}